---
title: 本文概述根據核心元件在最適化表單中規則編輯器的各種使用案例。
description: 本文探索基於核心元件之調適型表單中規則編輯器的各種使用案例。 此外也著重說明如何使用自訂函式為表單建立量身打造的規則。
feature: Adaptive Forms, Core Components
role: User, Developer
level: Beginner, Intermediate
exl-id: 062ed441-6e1f-4279-9542-7c0fedc9b200
source-git-commit: f772a193cce35a1054f5c6671557a6ec511671a9
workflow-type: tm+mt
source-wordcount: '1975'
ht-degree: 0%

---

# 規則編輯器增強功能和使用案例

<span class="preview">這些是透過我們的<a href="https://experienceleague.adobe.com/docs/experience-manager-cloud-service/content/release-notes/prerelease.html#new-features">發行前通道</a>提供的發行前功能。 這些增強功能也適用於Edge Delivery Services Forms。

本文介紹Adaptive Forms中規則編輯器的最新增強功能。 這些更新可協助您更輕鬆地定義表單行為，而不需撰寫自訂程式碼，並建立更動態、回應速度更快、更個人化的表單體驗。

下表列出調適型Forms中規則編輯器的近期增強功能，以及每項功能的簡短說明和主要優點：

| 增強功能 | 說明 | 優點 |
|---|----|---|
| [使用validate()方法進行驗證](#validate-method-in-function-list) | 可在函式清單中取得，以驗證個別欄位、面板或整個表單。 |  — 面板、欄位或表單層級<br>的精細驗證 — 目標錯誤訊息<br>提供更佳的使用者體驗 — 防止資料不完整的進度<br> — 減少表單提交錯誤 |
| [下載記錄檔案](#download-document-of-record) | 在規則編輯器中提供的現成可用函式可下載記錄檔案(DoR)。 |  — 下載DoR <br>不需要任何自訂開發 — 各表單間有一致的下載體驗 |
| [動態變數](#support-for-dynamic-variables-in-rules) | 使用根據使用者輸入或其他條件而變更的變數來建立規則。 |  — 啟用彈性的規則條件<br> — 減少重複邏輯<br>的需求 — 消除建立隱藏欄位的要求 |
| [自訂事件型規則](#custom-event-based-rules-support) | 定義可回應標準觸發程式以外自訂事件的規則。 |  — 支援進階使用案例<br> — 更深入控制執行規則的時間和方式<br> — 增強互動性 |
| [內容感知可重複面板執行](#context-based-rule-execution-for-repeatable-panels) | 規則現在會在每個重複面板的正確內容中執行，而非僅在最後一個例項中執行。 |  — 每個重複執行個體<br>的精確規則應用程式 — 減少動態區段<br>中的錯誤 — 改善使用者對重複內容的體驗 |
| [支援查詢字串、UTM和瀏覽器引數](#url-and-browser-parameter-based-rules-in-adaptive-forms) | 建立可根據URL引數或瀏覽器特定值來調整表單行為的規則。 |  — 根據來源或環境<br>啟用個人化 — 對行銷或追蹤特定流程<br>很有用 — 不需要額外的指令碼或自訂 |

>[!NOTE]
>
> 增強功能也適用於Edge Delivery Services Forms[的](/help/edge/docs/forms/universal-editor/rule-editor-universal-editor.md)規則編輯器。

現在，讓我們透過特定使用案例來詳細探索每個方法，以幫助您瞭解如何使用這些功能為使用者提供個人化體驗

## 函式清單中的驗證方法

增強驗證功能，允許在函式清單中使用&#x200B;**validate()**&#x200B;方法來驗證面板、欄位或整個表單。 例如，在多步驟貸款申請表單中，您必須先驗證不同的區段，才能讓使用者繼續進行下一個步驟。

**案例：**&#x200B;金融機構提供多步驟貸款申請表單，使用者必須完成不同的區段，例如：

* 個人詳細資料
* 僱用詳細資料
* 貸款詳細資訊
* 檢閱並提交

在使用者從一個步驟移動到下一個步驟之前，表單必須僅驗證當前區段中的欄位。 例如，除非正確填寫「個人詳細資料」中的所有必要欄位，否則不應允許使用者繼續前往「僱用詳細資料」。

在規則編輯器中使用validate()的&#x200B;**實作**

每個面板中的&#x200B;**Next**&#x200B;按鈕會使用&#x200B;**validate()**&#x200B;方法觸發規則。 此規則會檢查目前面板中的所有欄位是否有效。 如果驗證通過，表單會導覽至下一個面板。 如果沒有，則會顯示錯誤訊息，引導使用者更正輸入。

下面的熒幕擷圖顯示套用至&#x200B;**下一步**&#x200B;按鈕的規則：

![驗證下一個按鈕](/help/forms/assets/validate-next.png)

在上述規則中，**下一步**&#x200B;按鈕會檢查&#x200B;**個人詳細資料**&#x200B;區段中的欄位是否有效。 如果詳細資料無效，焦點會移至&#x200B;**個人詳細資料**&#x200B;面板中的&#x200B;**名稱**&#x200B;欄位。

![輸出](/help/forms/assets/valid-output.png)

>[!NOTE]
>
>您可以在表單、片段或個別欄位上使用&#x200B;**validate()**&#x200B;方法。 當片段包含在表單中時，表單和片段都會顯示為驗證內容中的選項。 在這種情況下，片段會參考其中的欄位，而表單會參考其中嵌入片段的父表單。

## 下載記錄文件

使用規則編輯器中的&#x200B;**DownloadDor()**&#x200B;現成可用(OOTB)函式，可讓使用者下載記錄檔案（如果表單已設定為產生記錄檔案）。

>[!NOTE]
>
>如果表單未針對記錄檔案設定，則使用&#x200B;**downloadDoR()**&#x200B;函式的規則套用至按鈕時，會顯示錯誤訊息。

**案例**：政府機構提供發行憑證的數位申請表。 提交表單後，申請人通常需要填寫好的表單復本以作記錄，或與其他部門共用。 為了改善使用者體驗，機構希望讓申請人選擇在提交後立即下載記錄檔案(DoR)，或在最終提交前的任何階段下載。

在規則編輯器中使用DownloadDor()的&#x200B;**實作**

已使用規則編輯器將&#x200B;**下載**&#x200B;按鈕新增至表單，已設定規則以在按一下按鈕時觸發&#x200B;**DownloadDor()**&#x200B;函式。

下面的熒幕擷圖顯示套用至&#x200B;**下載**&#x200B;按鈕的規則：

![下載按鈕規則](/help/forms/assets/download-button-rule.png)

>[!NOTE]
>
> **Input**&#x200B;欄位可讓使用者指定可下載檔案的檔案名稱。 此為選用引數。

如果表單是針對DoR產生所設定，此函式會立即產生和下載PDF，而不需要任何自訂函式。

![記錄檔案](/help/forms/assets/download-dor-output.png)

## 支援規則中的動態變數

增強型規則編輯器支援建立和使用動態（暫時）變數。 您可以使用內建的&#x200B;**設定變數值**&#x200B;和&#x200B;**取得變數值**&#x200B;函式，在表單的整個生命週期中設定及擷取這些變數。
這些變數：

* 未隨表單資料一起提交。
* 可以保留中間值或計算值。
* 可用於條件邏輯和動作。

**案例**：線上購物表單可讓使用者選取產品、輸入數量，以及選擇運送的國家/地區。 產品價格是透過表單欄位擷取的固定值，而出貨費則視所選國家/地區而動態變化。

為避免表單與隱藏欄位混亂，企業決定將運費儲存在臨時變數中，並將其用於即時計算。

在規則編輯器中使用設定變數值和取得變數值函式的&#x200B;**實作**

>[!VIDEO](https://video.tv.adobe.com/v/3471607/get-set-variable-final-video/?quality=12&learn=on)

已在&#x200B;**位址**&#x200B;片段上使用&#x200B;**設定變數值**&#x200B;函式設定規則，以指派名為&#x200B;**extracharge**&#x200B;的暫存變數。 此變數的值會根據選取的國家/地區動態變更。 例如：

* 如果使用者選取「美國」，則&#x200B;**Extracharge**&#x200B;設定為500。
* 對於任何其他國家/地區，**extracharge**&#x200B;設定為100。

![設定變數值](/help/forms/assets/setvalue.png)

稍後，在計算&#x200B;**總運送成本**&#x200B;時，會使用&#x200B;**Get Variable Value**&#x200B;函式來擷取&#x200B;**excache**&#x200B;的值。 這個值會新增至&#x200B;**產品價格×產品數量**，以計算按一下按鈕時的最終應付金額。

![取得變數值](/help/forms/assets/getvalue.png)

**總出貨成本**&#x200B;欄位會隨著使用者變更國家或數量而動態更新，以反映產品成本和出貨費用。
![輸出](/help/forms/assets/getsetvalue-output.png)

>[!NOTE]
>
> 您也可以在When條件中新增&#x200B;**Get Variable value**&#x200B;函式。
> &#x200B;> ![條件](/help/forms/assets/when-get-variable.png){width=50%，height=50%，align=center}中的取得變數值函式

此方法可啟用動態即時計算，而不會在表單中新增額外欄位，保持結構簡潔且方便使用。

## 自訂事件型規則支援

增強型規則編輯器支援使用&#x200B;**分派事件**&#x200B;和&#x200B;**觸發事件**&#x200B;函式來處理自訂事件。 這些函式可讓表單的不同部分透過發出和收聽自訂事件來進行通訊，啟用更乾淨、模組化的邏輯，而不會將動作緊密耦合到特定欄位。

**案例**：登入表單是使用可重複使用的登入片段建置，其中包含&#x200B;**輸入使用者名稱**&#x200B;和&#x200B;**輸入密碼**&#x200B;欄位。 當使用者提供有效的認證時，表單會驗證輸入並起始&#x200B;**取得OTP**&#x200B;程式。 使用者輸入有效的OTP後，系統會將使用者重新導向至適當的頁面。

此表單不是直接將邏輯繫結至欄位，而是使用包含&#x200B;**分派事件**&#x200B;和&#x200B;**觸發事件**&#x200B;的事件型方法，以改善模組化及可維護性。

**使用分派事件和觸發事件時的實作**


>[!VIDEO](https://video.tv.adobe.com/v/3471610/dispatch-trigger-final/?quality=12&learn=on)

登入片段會新增至表單，包含預先定義的使用者名稱和密碼欄位。 在&#x200B;**取得OTP**&#x200B;按鈕上設定規則以顯示&#x200B;**驗證面板**，其中包含輸入及驗證OTP的輸入欄位。

![取得OTP規則](/help/forms/assets/get-otp-rule.png)

在&#x200B;**驗證面板**&#x200B;中，已在[驗證]按鈕上設定規則。 API整合用於驗證在&#x200B;**輸入OTP**&#x200B;欄位中輸入的OTP。 如果驗證成功，就會觸發名為&#x200B;**LoggedIn**&#x200B;的&#x200B;**分派事件**，其中包含包含API回應的事件裝載。

![在觸發事件規則中](/help/forms/assets/trigger-event-rule.png)

在表單層級，規則已設定為接聽&#x200B;**LoggedIn**&#x200B;事件。 觸發此事件時，規則會顯示重新導向訊息，並將使用者導向控制面板頁面。

![分派事件規則](/help/forms/assets/dispatch-event-rule.png)

當使用者提交具有正確憑證和有效OTP的表單時，登入成功，使用者將被重新導向到他們的儀表板。

自訂事件支援可讓開發人員建立和觸發自訂事件，這些事件可在規則編輯器中作為條件使用。

## 可重複面板的內容型規則執行

最適化Forms支援可重複面板的內容感知規則執行。 這可讓規則專門套用至使用者互動的面板執行個體，而非影響所有執行個體或預設為最後一個執行個體。

**案例**：產品訂購單可讓使用者在不同的面板中新增多個產品。 每個面板都包含&#x200B;**Number of Product**&#x200B;欄位和&#x200B;**總成本**&#x200B;欄位。 當使用者更新產品的數量時，表單應重新計算總價，但僅限該特定面板，而非所有其他面板。

**在規則編輯器中使用內容感知規則的實作**

已在可重複產品面板內的&#x200B;**Number of Product**&#x200B;欄位上設定規則。

以下熒幕擷圖顯示重複產品面板中&#x200B;**Number of Product**&#x200B;欄位的規則：

![產品規則數目](/help/forms/assets/number-of-product-rule.png)

變更數量時，規則會擷取所選產品的單價，並只計算該面板的總成本。

![內容感知規則輸出](/help/forms/assets/context-aware-rule-output.png)

## Adaptive Forms中的URL和瀏覽器引數型規則

最適化Forms支援使用透過表單URL傳遞或衍生自使用者瀏覽器環境的外部引數來執行動態規則。 這會根據訪客的來源或他們使用的裝置，啟用個人化和內容感知的表單體驗。

## 允許的引數型別

| 引數型別 | 支援的選項 | 說明 | 範例值 |
| --- | --- | --- | ---|
| 查詢引數 | `ref` （僅限字串值） | `?`之後的URL中的泛型索引鍵/值組 | `?ref=partner123` |
| UTM引數 | UTM Source<br>UTM Medium<br>UTM行銷活動<br>UTM辭彙<br>UTM內容 | 用於行銷活動追蹤的特殊查詢引數 | `?utm_source=google&utm_medium=email` |
| URL 參數 | 主機名稱<br>路徑 | 擷取表單URL的結構元件 | `hostname=www.example.com`、`path=/signup` |
| 瀏覽器引數 | 瀏覽器代理程式<br>瀏覽器語言<br>瀏覽器平台 | 衍生自使用者瀏覽器或裝置的值 | `Browser Agent=Mozilla`、`Language=en-US` |

**案例**：潛在客戶產生表單需要根據流量來源量身打造其歡迎訊息。 當使用者透過Google廣告行銷活動登陸表單時（在URL中使用utm_source=google），表單應該顯示自訂問候語。

使用UTM引數的&#x200B;**實作**

在文字欄位上設定規則，向Google使用者顯示自訂訊息，且使用&#x200B;**utm_source**&#x200B;引數。

下方熒幕擷圖顯示文字訊息設定的規則：

文字訊息上的![規則](/help/forms/assets/utm-param-rule.png)

如果&#x200B;**utm_source**&#x200B;引數值等於「google」，則會出現自訂訊息，顯示「Hello Google使用者，歡迎使用Campaign廣告！」 「 」會顯示。

![utm-param-output](/help/forms/assets/utm-param-output.png)

這可讓行銷人員根據行銷活動將相關內容提供給使用者，讓使用者形成表單，而不需要手動欄位輸入或自訂指令碼。

這些增強功能大幅擴充最適化Forms規則編輯器的功能，為開發人員提供強大工具，可建立更動態、互動和智慧型表單。 每項增強功能皆可因應特定業務需求，同時維持易用性，好讓技術和非技術使用者都能存取規則編輯器。

## 其他資源

{{see-also-rule-editor}}
