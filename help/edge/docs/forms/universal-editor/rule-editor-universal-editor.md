---
title: 通用編輯器中動態Forms的規則編輯器
description: 使用通用編輯器中的規則編輯器建立動態的智慧型表單。 新增條件式邏輯、計算及互動行為，無需編碼。
feature: Edge Delivery Services
role: Admin, Architect, Developer
level: Intermediate
exl-id: 846f56e1-3a98-4a69-b4f7-40ec99ceb348
source-git-commit: 2e2a0bdb7604168f0e3eb1672af4c2bc9b12d652
workflow-type: tm+mt
source-wordcount: '3597'
ht-degree: 22%

---


# 通用編輯器中動態Forms的規則編輯器

Universal Editor中的規則編輯器可讓您建立智慧型動態表單，以即時回應使用者的輸入。 您可以將靜態表單轉換為具有條件欄位可見性、自動化計算和複雜商業邏輯的互動式體驗，而完全不需要撰寫程式碼。

## 學習內容

在本指南結束時，您將瞭解：

- 瞭解規則如何運作以及何時使用不同的規則型別
- 在通用編輯器中啟用並存取規則編輯器
- 建立條件式邏輯以動態顯示或隱藏表單欄位
- 實作自動化計算和資料驗證
- 為複雜的商業規則建立自訂函式
- 套用最佳實務以獲得最佳表單效能

## 為何使用規則編輯器？

**將靜態Forms轉換為智慧型體驗：**

- **條件式邏輯**：根據使用者選擇顯示相關欄位
- **動態計算**：自動計算使用者型別的值
- **資料驗證**：提供即時回饋並防止錯誤
- **已改善UX**：降低表單複雜度，並引導使用者完成邏輯流程
- **不需要編碼**：非開發人員可存取的視覺化介面

**常見使用案例：**

- 含條件扣減額的稅捐計算表單
- 具有分支路徑的多步驟精靈
- 包含費率計算的保險表單
- 有條件問題的調查表單
- 具有動態定價的電子商務表單

## 規則如何運作

規則是自動化指示，可讓您的表單智慧型且回應式化。 它們指定當滿足某些條件時應該發生的情況。

### **規則元件**

**條件**：評估為true或false的邏輯測試。

- 「使用者的收入是否超過$50,000？」
- 「使用者是否已為保險範圍選取『是』？」
- 「表單欄位是否為空白？」

**動作**：符合條件時產生的結果。

- 顯示或隱藏表單欄位
- 自動計算值
- 顯示驗證訊息
- 啟用或停用元件

### **規則邏輯模式**

**1. Condition-Action (When-Then)**

```
WHEN gross salary > 50000
THEN show "Additional Deduction" field
```

*最適合：*&#x200B;條件欄位可見性、動態內容

**2. Action-Condition (Set-If)**

```
SET taxable income = gross salary - deductions
IF deductions are applicable
```

*最適合：*&#x200B;計算、資料轉換

**3。 Action-Condition-Alternate (If-Then-Else)**

```
IF income > 50000
THEN show "High Income" fields
ELSE show "Standard Income" fields
```

*最適合：*&#x200B;分支邏輯、互斥選項

### **真實世界的範例**

**案例**：稅捐計算表單

- **條件**：「薪資總額超過$50,000美元」
- **主要動作**：顯示「額外扣除」欄位
- **替代動作**：隱藏[額外扣除]欄位
- **結果**：使用者只能根據其收入層級檢視相關欄位

## 先決條件

開始使用規則編輯器之前，請確定您具備下列條件：

### **存取需求**

- 正在編寫&#x200B;**AEM as a Cloud Service**&#x200B;的存取權
- 已啟用規則編輯器延伸的&#x200B;**通用編輯器**
- AEM環境中的表單編輯許可權

### **技術需求**

- **基本表單設計知識**：熟悉表單元件及其屬性
- **商業邏輯熟悉度**：可定義條件式需求
- **基本JavaScript知識** （只有自訂函式才需要）

### **啟用規則編輯器延伸**

通用編輯器並未預設啟用規則編輯器擴充功能。您可以從[Extension Manager](/help/implementing/developing/extending/extension-manager.md)啟用它。

**啟用擴充功能後：**
當您選取表單元件時，![edit-rules](/help/forms/assets/edit-rules-icon.svg)圖示會出現在右上角。

![通用編輯器規則編輯器](/help/edge/docs/forms/assets/universal-editor-rule-editor.png)
*圖：當您選取表單元件時，規則編輯器圖示會出現*

**存取規則編輯器：**

1. 在通用編輯器中選取任何表單元件。
2. 按一下出現的![edit-rules](/help/forms/assets/edit-rules-icon.svg)圖示。
3. 規則編輯器介面會在新面板中開啟。

![規則編輯器使用者介面](/help/edge/docs/forms/assets/rule-editor-for-field.png)
*圖：用於編輯元件規則的規則編輯器介面*

>[!NOTE]
>
> 在本文中，「表單元件」和「表單元件」是指相同的元素（例如輸入欄位、按鈕、面板等）。

## 規則編輯器介面概觀

規則編輯器提供方便使用的視覺介面，用於建立和管理規則：

![規則編輯器使用者介面](/help/edge/docs/forms/assets/rule-editor-interface.png)
*圖：具有編號元件的完整規則編輯器介面*

### **介面元件**

**1. 元件標題和規則型別**

- **用途**：顯示選取元件的名稱和目前的規則型別。
- **範例**：「輸入薪資總額」（文字輸入）並選取「何時」規則。
- **秘訣**：請務必確認您編輯的元件是否正確。

**2. 表單物件與函式面板**

- **表單物件標籤**：提供所有表單元件的階層檢視。
   - 用於：參考規則中的其他欄位。
   - 導覽：展開或摺疊以找出特定元件。
- **函式標籤**：包含內建的數學與邏輯函式。
   - 用於：執行複雜的計算和資料操作。
   - 類別：數學、字串、日期和驗證函式。

**3。 面板切換按鈕**

- **用途**：顯示或隱藏物件和函式面板。
- **提示**：關閉面板以增加規則編輯工作區。
- **鍵盤快速鍵**：使用複雜規則時相當有用。

**4。 視覺化規則產生器**

- **目的**：建構規則邏輯的主要區域。
- **功能**：拖放介面和下拉式選取器。
- **工作流程**：選取規則型別→定義條件→設定動作。

**5。 控制按鈕**

- **完成**：儲存規則並關閉編輯器。
- **取消**：放棄變更並關閉編輯器而不儲存。
- **秘訣**：按一下[完成]之前，一定要先測試您的規則。

### **規則管理**

針對已有規則的元件開啟規則編輯器時：

![顯示表單物件的可用規則](/help/edge/docs/forms/assets/rule-editor15.png)
*圖：管理表單元件的現有規則*

**可用的動作：**

- **檢視**：檢閱規則摘要和邏輯。
- **編輯**：修改現有的規則條件或動作。
- **重新排序**：變更規則的執行順序（從上到下執行規則）。
- **啟用/停用**：暫時開啟或關閉規則以進行測試。
- **刪除**：永久移除規則。

>[!TIP]
>
> **規則執行順序很重要**：規則是從上到下執行。 將更具體的條件放在一般條件之前。

## 可用的規則型別

規則編輯器提供一組完整的規則型別，並按功能加以整理。 根據您的特定使用案例選取適當的型別：

### **條件式邏輯規則**

**時間**

- **用途**：做為實作複雜邏輯的主要條件式規則。
- **使用案例**：例如，「當使用者選取&#39;已婚&#39;時，顯示配偶資訊欄位。」
- **邏輯模式**：條件→動作（含選用的替代動作）

**隱藏/顯示**

- **用途**：根據指定的條件控制欄位可見性。
- **使用案例**：隱藏無關的區段或啟用漸進式公開。
- **最佳實務**：使用建立乾淨、重點明確的使用者體驗。

**啟用/停用**

- **目的**：根據條件控制欄位是否可以互動。
- **使用案例**：停用提交按鈕，直到完成所有必要欄位為止。
- **最佳實務**：為使用者提供清楚的視覺化意見回饋。

### **資料操作規則**

**設定值**

- **用途**：自動填入欄位值。
- **使用案例**：設定今天的日期、計算總計，或複製欄位之間的值。
- **最佳實務**：使用減少使用者工作量，並確保準確性。

**清除**&#x200B;的值

- **目的**：在條件變更時，從欄位移除資料。
- **使用案例**：父選取範圍變更時清除相依欄位。
- **最佳實務**：維持資料完整性並防止孤立值。

**格式**

- **用途**：轉換值的顯示方式。
- **使用案例**：格式化貨幣、電話號碼或日期。
- **最佳實務**：改善可讀性，而不變更基礎資料。

### **驗證規則**

**驗證**

- **用途**：實作自訂驗證邏輯。
- **使用案例**：強制執行複雜的商業規則或跨欄位驗證。
- **最佳實務**：提供清楚且可操作的錯誤訊息。

### **計算規則**

**數學運算式**

- **用途**：執行自動計算。
- **使用案例**：稅捐計算、總計或百分比。
- **最佳實務**：以使用者型別即時更新計算。

### **使用者介面規則**

**設定焦點**

- **目的**：將使用者注意力導向特定欄位。
- **使用案例**：著重於錯誤欄位，或引導使用者完成精靈步驟。
- **最佳實務**：請謹慎使用，避免中斷使用者流程。

**設定屬性**

- **用途**：動態修改元件屬性。
- **使用案例**：變更預留位置文字或修改下拉式清單中的選項。
- **最佳實務**：透過內容變更增強使用者體驗。

### **表單控制項規則**

**提交表單**

- **用途**：以程式設計方式觸發表單提交。
- **使用案例**：在符合特定條件後自動提交。
- **最佳實務**：提交前請務必驗證表單。

**重設表單**

- **用途**：清除所有表單資料，並將表單重設為初始狀態。
- **使用案例**：「重新開始」功能。
- **最佳實務**：在重設之前，請先與使用者確認動作。

**儲存表單**

- **目的**：將表單儲存為草稿以供稍後完成。
- **使用案例**：適用於長表格或多工作階段工作流程。
- **最佳實務**：提供儲存狀態的明確回饋。

### **進階規則**

**啟動服務**

- **用途**：呼叫外部API或服務。
- **使用案例**：位址查詢、即時驗證或資料擴充。
- **最佳實務**：適當地處理載入狀態和錯誤案例。

**新增/移除執行個體**

- **用途**：動態管理可重複的區段。
- **使用案例**：新增家庭成員或多個地址。
- **最佳實務**：提供新增或移除執行個體的明確控制項。

**瀏覽至**

- **用途**：將使用者重新導向至其他表單或頁面。
- **使用案例**：多表單工作流程或條件式路由。
- **最佳實務**：導覽前先保留表單資料。

**在面板之間導覽**

- **用途**：精靈式表單中的控制項導覽。
- **使用案例**：多步驟表單或條件步驟略過。
- **最佳實務**：顯示清除進度指示器。

**分派事件**

- **用途**：觸發進階整合的自訂事件。
- **使用案例**： Analytics追蹤或第三方整合。
- **最佳實務**：僅用於非封鎖動作。


## 逐步教學課程：建立智慧稅務電腦

本節提供一個範例，說明規則編輯器的功能。 此範例會引導您建立使用條件式邏輯與自動化計算的稅捐計算表單。

![規則編輯器介面的熒幕擷圖，顯示建立條件式規則，以及表單欄位可見性的When-Then邏輯](/help/edge/docs/forms/assets/rule-editor-1.png)
*圖：含智慧型條件欄位的稅捐計算表單*

### **教學課程總覽**

在本教學課程中，您將建立符合以下條件的表單：

1. **適應使用者輸入**：根據收入層級顯示相關欄位。
2. **自動計算**：即時計算應納稅額。
3. **驗證資料**：確保計算與資料輸入正確無誤。

### **表單結構**

| 欄位名稱 | 類型 | 用途 | 行為 |
|------------|------|---------|----------|
| **總薪資** | 數字輸入 | 使用者輸入年收入 | 觸發條件式邏輯 |
| **額外扣款** | 數字輸入 | 額外扣除額（若適用） | 在薪資> $50,000時顯示 |
| **應課稅收入** | 數字輸入 | 已自動計算 | 更新輸入變更 |
| **應付稅金** | 數字輸入 | 最終稅捐金額 | 以10%的速率計算 |

### **要實作的商業邏輯**

**規則1：條件欄位顯示**

```
WHEN Gross Salary > 50,000
THEN Show "Additional Deduction" field
ELSE Hide "Additional Deduction" field
```

**規則2：應稅收入計算**

```
SET Taxable Income = Gross Salary - Additional Deduction
(When Additional Deduction is applicable)
```

**規則3：稅捐計算**

```
SET Tax Payable = Taxable Income × 10%
(Simplified flat rate for demonstration)
```

### **實作步驟**

請依照下列步驟建立您的智慧型稅捐表單：



+++ 1：建立Foundation表單

**目標**：使用所有必要元件建置基本表單結構

若要在「通用編輯器」中建立稅捐計算表單，請執行下列步驟：

1. **開啟通用編輯器**
   - 導覽至您的AEM Sites主控台
   - 選取您要新增表單的頁面
   - 按一下&#x200B;**編輯**&#x200B;以開啟通用編輯器

2. **新增表單元件**

   依序新增這些元件：

   | 元件 | 類型 | 標籤 | 設定 |
   |-----------|------|-------|----------|
   | 標題 | 標題 | 「稅捐計算表單」 | 標題層級H2 |
   | 數字輸入 | 數字輸入 | 「薪資毛額」 | 必要：是，預留位置：「輸入年薪」 |
   | 數字輸入 | 數字輸入 | 「額外扣除」 | 必要：否，預留位置：「輸入其他扣除專案」 |
   | 數字輸入 | 數字輸入 | 應課稅收入 | 必要：否，唯讀：是 |
   | 數字輸入 | 數字輸入 | 「應付稅金」 | 必要：否，唯讀：是 |
   | 提交按鈕 | 提交 | 計算稅金 | 型別：提交 |

3. **設定初始設定**

   - **隱藏額外扣除欄位**：
      - 選取「額外扣除」元件
      - 在[內容]面板中，將&#x200B;**Visible**&#x200B;設定為&#x200B;**No**
      - 此欄位將根據規則有條件地顯示

   - **將計算欄位設為唯讀**：
      - 選取「應課稅收入」與「應付稅金」欄位
      - 在屬性中將&#x200B;**唯讀**&#x200B;設定為&#x200B;**是**

     ![稅額計算表單的螢幕擷圖顯示薪資總額、婚姻狀況及受扶養子女的輸入欄位，顯示套用規則前的表單結構](/help/edge/docs/forms/assets/rule-editor2.png)
     *圖：已設定基本元件的初始表單結構*

**查核點**：您現在應該有一個包含所有必要欄位的表單，其中「額外扣除」是隱藏的，而計算欄位是唯讀的。

+++

+++ &#x200B;2. 新增表單欄位的條件式規則

製作表單後，請編寫第一條規則，只有在薪資總額超過 $50,000 時才顯示 `Additional Deduction` 欄位。若要新增條件式規則：

1. 在通用編輯器中開啟表單以進行編輯，然後選取內容樹中的「**[!UICONTROL 薪資總額]**」，並選取「![編輯規則](/help/forms/assets/edit-rules-icon.svg)」。或者，您可以直接從「**[!UICONTROL 表單物件]**」窗格選取「**[!UICONTROL 薪資總額]**」欄位。
   ![規則編輯器範例 1](/help/edge/docs/forms/assets/rule-editor3.png)
顯示規則編輯器視覺化介面。
1. 按一下「**[!UICONTROL 建立]**」，即可建立規則。
   ![規則編輯器範例 2](/help/edge/docs/forms/assets/rule-editor4.png)
依預設已選取 `Set Value Of` 規則類型。雖然您無法變更或修改所選物件，但可以使用規則下拉式清單以選取其他規則類型。\
   ![規則編輯器範例 3](/help/edge/docs/forms/assets/rule-editor5.png)
1. 開啟規則類型下拉式清單，並選取 **[!UICONTROL When]** 規則類型。
   ![規則編輯器範例 4](/help/edge/docs/forms/assets/rule-editor6.png)
1. 選取「**[!UICONTROL 選取狀態]**」下拉式清單並選取「**[!UICONTROL 大於]**」。接著顯示「**[!UICONTROL 輸入數字]**」欄位。
   ![規則編輯器範例 5](/help/edge/docs/forms/assets/rule-editor7.png)
1. 在規則的「**[!UICONTROL 輸入數字]**」欄位中輸入 `50000`。
   ![規則編輯器範例 6](/help/edge/docs/forms/assets/rule-editor8.png)
您已將條件定義為 `When Gross Salary is greater than 50000`。接下來，請定義如果條件為 `True` 時要執行的動作。
1. 在 `Then` 陳述式中，從「**[!UICONTROL 選取動作]**」下拉式清單選取「**[!UICONTROL 顯示]**」。
   ![規則編輯器範例 7](/help/edge/docs/forms/assets/rule-editor9.png)
1. 把「表單物件」索引標籤的「**[!UICONTROL 其他扣除額]**」欄位拖放到「**[!UICONTROL 放置物件或選取此處]**」欄位。或者，選取「**[!UICONTROL 放置物件或選取此處]**」欄位，並從列出表單中所有表單物件的快顯選單中選取「**[!UICONTROL 其他扣除額]**」欄位。
   ![規則編輯器範例 8](/help/edge/docs/forms/assets/rule-editor10.png)
1. 按一下「**[!UICONTROL 新增其他區段]**」，針對「**[!UICONTROL 薪資總額]**」欄位新增其他條件，以防您輸入的薪資低於 `50000`。
   ![規則編輯器範例 9](/help/edge/docs/forms/assets/rule-editor11.png)
1. 從 `Else` 陳述式的「**[!UICONTROL 選取動作]**」下拉式清單選取「**[!UICONTROL 隱藏]**」。
   ![規則編輯器範例 10](/help/edge/docs/forms/assets/rule-editor12.png)
1. 把「表單物件」索引標籤的「**[!UICONTROL 其他扣除額]**」欄位拖放到「**[!UICONTROL 放置物件或選取此處]**」欄位。或者，選取「**[!UICONTROL 放置物件或選取此處]**」欄位，並從列出表單中所有表單物件的快顯選單中選取「**[!UICONTROL 其他扣除額]**」欄位。
   ![規則編輯器範例 11](/help/edge/docs/forms/assets/rule-editor13.png)
1. 選取「**[!UICONTROL 完成]**」以儲存此規則。此規則在規則編輯器中顯示如下。
   ![規則編輯器範例 12](/help/edge/docs/forms/assets/rule-editor14.png)

>[!NOTE]
>
> 或者，您可以在「其他扣除額」欄位編寫「Show」規則，而非在「薪資總額」欄位編寫「When」規則，以執行相同行為。

+++

+++ &#x200B;3. 新增表單欄位的計算規則

接下來，編寫規則來計算 `Taxable Income`，即 `Gross Salary` 和 `Additional Deduction` 之間的差額 (如適用)。若要在「**[!UICONTROL 應稅所得]**」欄位中新增計算規則，請執行下列步驟：

1. 在製作模式中，選取「**[!UICONTROL 應稅所得]**」欄位，並選取![編輯規則](/help/forms/assets/edit-rules-icon.svg)圖示。或者，您可以直接從「**[!UICONTROL 表單物件]**」窗格選取「**[!UICONTROL 應稅所得]**」欄位。
1. 接下來，選取「**[!UICONTROL 建立]**」，即可建立規則。
   ![規則編輯器範例 13](/help/edge/docs/forms/assets/rule-editor16.png)
1. 選取「**[!UICONTROL 選取選項]**」，並選取「**[!UICONTROL 數學運算式]**」。開啟用於編寫數學運算式的欄位。
   ![規則編輯器範例 14](/help/edge/docs/forms/assets/rule-editor17.png)

1. 在數學運算式欄位：

   - 從「表單物件」索引標籤中選取或拖放「**[!UICONTROL 薪資總額]**」欄位到第一個「**[!UICONTROL 放置物件或選取此處]**」欄位。

   - 從「**[!UICONTROL 選取運算子]**」欄位選取「**[!UICONTROL 減]**」。

   - 從「表單物件」索引標籤選取或拖放「**[!UICONTROL 其他扣除額]**」欄位到另一個「**[!UICONTROL 放置物件或選取此處]**」欄位。
     ![規則編輯器範例 15](/help/edge/docs/forms/assets/rule-editor18.png)

1. 選取「**[!UICONTROL 完成]**」以儲存此規則。

   現在為「`Tax Payable `」欄位新增規則，而此欄位是由應稅所得乘以稅率計算得出。為簡單起見，假設固定稅率為 `10%`。

1. 在製作模式中，選取「**[!UICONTROL 應納稅額]**」欄位，並選取![編輯規則](/help/forms/assets/edit-rules-icon.svg)圖示。接下來，選取「**[!UICONTROL 建立]**」，即可建立規則。
   ![規則編輯器範例 16](/help/edge/docs/forms/assets/rule-editor19.png)
1. 選取「**[!UICONTROL 選取選項]**」，並選取「**[!UICONTROL 數學運算式]**」。開啟用於編寫數學運算式的欄位。
   ![規則編輯器範例 17](/help/edge/docs/forms/assets/rule-editor20.png)
1. 在數學運算式欄位：

   - 從「表單物件」索引標籤中選取或拖放「**[!UICONTROL 應稅所得]**」欄位到第一個「**[!UICONTROL 放置物件或選取此處]**」欄位。

   - 從「**[!UICONTROL 選取運算子]**」欄位選取「**[!UICONTROL 乘以]**」。

   - 從「**[!UICONTROL 選取選項]**」欄位選取「**數字**」，並在「**[!UICONTROL 輸入數字]**」欄位中輸入值 `10`。
     ![規則編輯器範例 18](/help/edge/docs/forms/assets/rule-editor21.png)
1. 接下來，選取運算式欄位周圍醒目標示的區域，並選取「**[!UICONTROL 擴充運算式]**」。
   ![規則編輯器範例 19](/help/edge/docs/forms/assets/rule-editor22.png)
1. 在擴展運算式欄位中，從「**[!UICONTROL 選取運算子]**」欄位選取「**[!UICONTROL 除以]**」以及從「**[!UICONTROL 選取選項]**」欄位選取「**[!UICONTROL 數字]**」。然後，在數字欄位指定 `100`。
   ![規則編輯器範例 20](/help/edge/docs/forms/assets/rule-editor23.png)
1. 選取「**[!UICONTROL 完成]**」以儲存此規則。

+++

+++ &#x200B;4. 預覽表單

現在，當您預覽表單並輸入「**薪資總額**」為 `60,000` 時，會顯示「**其他扣除額**」欄位，並據此計算「**應稅所得**」和「**應納稅額**」。

![預覽表單](/help/edge/docs/forms/assets/rule-editor-form.png)

+++

除了Sum和Average之類的內建函式以外，您可以建立自訂函式，以實作符合您特定需求的複雜商業邏輯。

## 進階：自訂函式

**何時使用自訂函式：**

- 適用於超出內建函式功能的複雜計算
- 實作特定企業驗證規則
- 針對資料轉換和格式設定
- 與外部系統或API整合的方式

**優點：**

- **可重複使用**：寫入函式一次，然後跨多個表單和規則使用
- **可維護性**：易於更新的集中式邏輯
- **效能**：最佳化的JavaScript執行
- **彈性**：能夠處理標準規則未處理的複雜案例

### **正在建立自訂函式**

**檔案位置**： AEM專案中的`/blocks/form/functions.js`

**開發工作流程：**

1. **函式宣告**
   - 定義清楚且描述性的函式名稱和引數
   - 使用可指出函式用途的名稱
   - 檔案引數和傳回型別

2. **邏輯實作**
   - 撰寫簡潔且高效的JavaScript程式碼
   - 處理邊緣案例和錯誤案例
   - 遵循編碼最佳實務

3. **函式匯出**
   - 匯出函式，以便在規則編輯器中使用
   - 使用具名匯出，以提升組織品質
   - 部署前測試功能

4. **文件**
   - 為函式檔案新增JSDoc註解
   - 包含使用範例
   - 指定引數型別和傳回值

下列範例示範兩個自訂函式： `getFullName`和`days`。

```JavaScript
/**
 - Get Full Name
 - @name getFullName Concats first name and last name
 - @param {string} firstname in Stringformat
 - @param {string} lastname in Stringformat
 - @return {string}
 */
function getFullName(firstname, lastname) {
  return `${firstname} ${lastname}`.trim();
}

/**
 - Calculate the number of days between two dates.
 - @param {*} endDate
 - @param {*} startDate
 - @name days Calculates the numebr of days between two dates
 - @returns {number} returns the number of days between two dates
 */
function days(endDate, startDate) {
  const start = typeof startDate === 'string' ? new Date(startDate) : startDate;
  const end = typeof endDate === 'string' ? new Date(endDate) : endDate;

  // return zero if dates are valid
  if (Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {
    return 0;
  }

  const diffInMs = Math.abs(end.getTime() - start.getTime());
  return Math.floor(diffInMs / (1000 * 60 * 60 * 24));
}

// eslint-disable-next-line import/prefer-default-export
export { getFullName, days };
```

![新增自訂函數](/help/edge/docs/forms/assets/create-custom-function.png)

### 在規則編輯器中使用自訂函數

若要在規則編輯器中使用自訂函式：

1. **新增函式**：將自訂函式新增至`../[blocks]/form/functions.js`檔案。 請確定您將其包含在檔案中的`export`陳述式中。
2. **部署檔案**：將更新的`functions.js`檔案部署至您的GitHub專案，並確認建置成功完成。
3. **函式使用方式**：在您的表單的規則編輯器中，選取`Function Output`選取動作&#x200B;**[!UICONTROL 欄位中的]**&#x200B;選項來存取函式。

   ![規則編輯器中的自訂函數](/help/edge/docs/forms/assets/custom-function-rule-editor.png)

4. **預覽表單**：預覽您的表單，以驗證新實作的函式是否如預期般運作。

## 規則開發的最佳作法

### **效能最佳化**

**將規則複雜度降至最低**

- 讓個別規則簡單且重點。
- 將複雜的邏輯分成多個較小的規則。
- 儘可能避免深度巢狀狀況。

**最佳化規則執行**

- 將最常觸發的規則放在最前。
- 使用特定條件來減少不必要的評估。
- 考量規則對表單載入時間的影響。

**資源管理**

- 限制每個表單元件的規則數。
- 將自訂函式用於重複的邏輯，而非複製規則。
- 以真實資料量測試效能。

### **使用者體驗准則**

**提供清楚的意見反應**

- 使用驗證訊息，引導使用者進行正確的輸入。
- 顯示載入內含外部服務之規則的指標。
- 實施漸進式公開，以減少認知負擔。

**維持表單回應**

- 避免產生突然視覺變化的規則。
- 針對顯示/隱藏作業實作平滑切換。
- 測試不同裝置和熒幕大小的規則。

**錯誤處理**

- 提供規則失敗時的遞補行為。
- 顯示好記的錯誤訊息。
- 記錄進行偵錯的錯誤，同時保持良好的使用者體驗。

### **開發最佳實務**

**測試策略**

- 測試包含邊緣案例和邊界值的規則。
- 驗證不同瀏覽器的規則行為。
- 測試表單功能，包括是否啟用JavaScript。

**文件**

- 記錄複雜規則背後的商業邏輯。
- 維護大型表單的規則詳細目錄。
- 對元件和規則使用一致的命名慣例。

**版本控制**

- 追蹤版本控制中自訂函式的變更。
- 在生產之前在開發環境中測試規則。
- 維護工作規則設定的備份復本。

## 疑難排解常見問題

### **規則執行問題**

**規則未觸發**

- **檢查元件名稱**：確認參考的元件存在且名稱正確。
- **驗證規則順序**：規則會從上到下執行；如有需要，請重新排序。
- **驗證條件**：使用已知值來驗證邏輯的測試條件。
- **瀏覽器主控台**：檢查可能封鎖執行的JavaScript錯誤。

**不正確的規則行為**

- **檢閱邏輯運運算元**：確認AND/OR條件結構正確。
- **使用範例資料進行測試**：使用已知值來隔離問題。
- **檢查資料型別**：確保數值比較使用數字，而非字串。
- **驗證運算式**：分別測試數學運算式。

### **效能問題**

**慢速表單回應**

- **降低規則複雜性**：簡化複雜的條件邏輯。
- **最佳化自訂函式**：設定檔並最佳化JavaScript程式碼。
- **限制外部呼叫**：將規則中的服務呼叫最小化。
- **使用有效的選取器**：確定表單物件參考是特定的。

**記憶體使用量**

- **清除事件接聽程式**：移除未使用的規則繫結。
- **最佳化自訂函式**：避免JavaScript程式碼中的記憶體遺失。
- **限制規則範圍**：使用目標規則，而非全域條件。

### **自訂函式問題**

**函式無法使用**

- **檢查檔案路徑**：確認`functions.js`位於正確的位置： `/blocks/form/functions.js`。
- **驗證匯出**：確認函式已正確匯出。
- **建置程式**：確認專案建置包含更新的函式檔。
- **快取清除**：部署新函式後清除瀏覽器快取。

**函式錯誤**

- **引數驗證**：檢查函式引數是否符合預期的型別。
- **錯誤處理**：新增try-catch區塊以正常處理例外狀況。
- **主控台記錄**：使用console.log執行偵錯函式。
- **JSDoc驗證**：確定函式檔案符合實作。

### **通用編輯器整合**

**規則編輯器未出現**

- **擴充功能已啟用**：驗證規則編輯器擴充功能是否已啟動。
- **元件選擇**：請確定您已選取支援的表單元件。
- **瀏覽器相容性**：在支援的瀏覽器(Chrome、Firefox、Safari)中測試。
- **存取許可權**：確認使用者擁有必要的AEM許可權。

**介面問題**

- **面板可見性**：使用切換按鈕來顯示或隱藏表單物件面板。
- **規則儲存**：在關閉編輯器之前，請確定已儲存規則。
- **瀏覽器縮放**：將瀏覽器縮放重設為100%以最佳化介面顯示。

## 重要限制

>[!IMPORTANT]
>
> **自訂函式限制**：
>
> - 自訂函式指令碼不支援靜態和動態匯入。
> - 所有程式碼必須直接包含在`/blocks/form/functions.js`檔案中。
> - 函式必須是同步的（沒有非同步/等待或Promise）。
> - 基於安全考量，瀏覽器API的存取權受到限制。

>[!WARNING]
>
> **生產考量**：
>
> - 在中繼環境中徹底測試所有規則。
> - 部署複雜規則後監視表單效能。
> - 制定規則相關問題的復原計畫。
> - 考慮對網路連線緩慢的使用者的影響。

## 摘要

Universal Editor中的規則編輯器可讓您建立智慧型動態表單，提供卓越的使用者體驗。 透過實作條件式邏輯、自動化計算和自訂商業規則，您可以：

**轉換靜態Forms**：

- 新增條件式欄位可見度，讓介面更乾淨、更集中。
- 實作即時計算和資料驗證。
- 無需編碼即可建立複雜的商業邏輯。

**改善使用者體驗**：

- 引導使用者完成邏輯表單流程。
- 減少智慧型驗證的錯誤。
- 立即提供意見回饋和協助。

**提升效率**：

- 自動重複計算及資料輸入。
- 使用智慧路由簡化複雜的工作流程。
- 利用自助服務功能減輕支援負擔。

### **後續步驟**

現在您已瞭解規則編輯器基本知識：

1. **開始簡單**：先從基本的顯示/隱藏規則開始，再進行複雜的計算。
1. **使用範例實作**：使用稅捐計算器教學課程作為基礎。
1. **探索進階功能**：嘗試使用自訂功能來滿足特殊需求。
1. **徹底測試**：一律驗證不同案例和裝置間的規則。
1. **監視器效能**：確保規則增強而非阻礙使用者體驗。
